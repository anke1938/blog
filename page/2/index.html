<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"dev8888.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一个小站">
<meta property="og:type" content="website">
<meta property="og:title" content="Tree&#39;s Technology">
<meta property="og:url" content="http://dev8888.cn/page/2/index.html">
<meta property="og:site_name" content="Tree&#39;s Technology">
<meta property="og:description" content="一个小站">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Tree">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://dev8888.cn/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Tree's Technology</title>
  





<link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Tree's Technology</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录代码技术</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tree"
      src="/uploads/123.jpg">
  <p class="site-author-name" itemprop="name">Tree</p>
  <div class="site-description" itemprop="description">一个小站</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://gitee.com/anke1938" title="GitHub → https:&#x2F;&#x2F;gitee.com&#x2F;anke1938" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:anke1938@qq.com" title="E-Mail → mailto:anke1938@qq.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2021/01/20/springcloud%E4%B8%AD%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BC%A0%E9%80%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/20/springcloud%E4%B8%AD%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BC%A0%E9%80%92/" class="post-title-link" itemprop="url">springcloud中的上下文传递</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-20 15:53:18" itemprop="dateCreated datePublished" datetime="2021-01-20T15:53:18+08:00">2021-01-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="刚刚遇到的问题"><a href="#刚刚遇到的问题" class="headerlink" title="刚刚遇到的问题"></a>刚刚遇到的问题</h4><blockquote>
<ol>
<li>将用户登录拆成一个微服务</li>
<li>因为使用的是JWT,鉴权需要token,而token在请求头中,默认配置会在服务调用时候丢失HttpServletRequest</li>
<li>导致登录不成功,因为没有传递token,肯定也不能使用参数传递,根本原因是上下文丢失</li>
</ol>
</blockquote>
<h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><blockquote>
<p>需要在服务调用方添加拦截器,添加header到 fegin的请求中,这样就可以啦</p>
</blockquote>
<h6 id="建立-FeignRequestInterceptor-并给其添加-Configuration-注解，代码如下"><a href="#建立-FeignRequestInterceptor-并给其添加-Configuration-注解，代码如下" class="headerlink" title="建立 FeignRequestInterceptor 并给其添加@Configuration 注解，代码如下"></a>建立 <code>FeignRequestInterceptor</code> 并给其添加<code>@Configuration</code> 注解，代码如下</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Description:</span><br><span class="line"> * 微服务之间feign调用请求头丢失的问题</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@Slf4j</span><br><span class="line">public class FeignRequestInterceptor implements RequestInterceptor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void apply(RequestTemplate template) &#123;</span><br><span class="line">        HttpServletRequest httpServletRequest =   getHttpServletRequest();</span><br><span class="line">        if(httpServletRequest!=null)&#123;</span><br><span class="line">            Map&lt;String, String&gt; headers = getHeaders(httpServletRequest);</span><br><span class="line">            // 传递所有请求头,防止部分丢失</span><br><span class="line">            //此处也可以只传递认证的header</span><br><span class="line">            //requestTemplate.header(&quot;Authorization&quot;, request.getHeader(&quot;Authorization&quot;));</span><br><span class="line">            for (Map.Entry&lt;String, String&gt; entry : headers.entrySet()) &#123;</span><br><span class="line">                template.header(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(&quot;FeignRequestInterceptor:&#123;&#125;&quot;, template.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private HttpServletRequest getHttpServletRequest() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取原请求头</span><br><span class="line">     */</span><br><span class="line">    private Map&lt;String, String&gt; getHeaders(HttpServletRequest request) &#123;</span><br><span class="line">        Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();</span><br><span class="line">        Enumeration&lt;String&gt; enumeration = request.getHeaderNames();</span><br><span class="line">        if(enumeration!=null)&#123;</span><br><span class="line">            while (enumeration.hasMoreElements()) &#123;</span><br><span class="line">                String key = enumeration.nextElement();</span><br><span class="line">                String value = request.getHeader(key);</span><br><span class="line">                map.put(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2021/01/12/LDAP%E6%9C%8D%E5%8A%A1%E7%9A%84docker%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/12/LDAP%E6%9C%8D%E5%8A%A1%E7%9A%84docker%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">LDAP服务的docker安装使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-12 19:31:20" itemprop="dateCreated datePublished" datetime="2021-01-12T19:31:20+08:00">2021-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>23 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="LDAP服务的docker安装使用"><a href="#LDAP服务的docker安装使用" class="headerlink" title="LDAP服务的docker安装使用"></a>LDAP服务的docker安装使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建并进入映射目录  </span></span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/ldap &amp;&amp; <span class="built_in">cd</span> /usr/local/ldap</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line">docker run \</span><br><span class="line">-d \</span><br><span class="line">-p 389:389 \</span><br><span class="line">-p 636:636 \</span><br><span class="line">-v /usr/local/ldap:/usr/local/ldap \</span><br><span class="line">--name ldap \</span><br><span class="line">osixia/openldap:1.3.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认的配置 可修改  </span></span><br><span class="line">dn dc=example,dc=org</span><br><span class="line">admin admin,dc=example,dc=org</span><br><span class="line">password admin</span><br></pre></td></tr></table></figure>

<h5 id="验证安装的LDAP服务是否可用"><a href="#验证安装的LDAP服务是否可用" class="headerlink" title="验证安装的LDAP服务是否可用"></a>验证安装的LDAP服务是否可用</h5><blockquote>
<p>主要是admin的用户名和密码</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it ldap ldapsearch -x -H ldap://localhost:389 -b dc=example,dc=org -D <span class="string">&quot;cn=admin,dc=example,dc=org&quot;</span> -w admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># -------&gt;   返回</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;dc=example,dc=org&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: (objectclass=*)</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># example.org</span></span><br><span class="line">dn: dc=example,dc=org</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectClass: organization</span><br><span class="line">o: Example Inc.</span><br><span class="line">dc: example</span><br><span class="line"></span><br><span class="line"><span class="comment"># admin, example.org</span></span><br><span class="line">dn: cn=admin,dc=example,dc=org</span><br><span class="line">objectClass: simpleSecurityObject</span><br><span class="line">objectClass: organizationalRole</span><br><span class="line">cn: admin</span><br><span class="line">description: LDAP administrator</span><br><span class="line">userPassword:: e1NTSEF9SzNrZCtzdjZIY3NLRWdQZVd0VGZITUlXVFVlUUhjaFE=</span><br><span class="line"></span><br><span class="line"><span class="comment"># search result</span></span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"><span class="comment"># numResponses: 3</span></span><br><span class="line"><span class="comment"># numEntries: 2</span></span><br></pre></td></tr></table></figure>

<h5 id="搭建-phpLDAPadmin"><a href="#搭建-phpLDAPadmin" class="headerlink" title="搭建 phpLDAPadmin"></a>搭建 phpLDAPadmin</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -dit \</span><br><span class="line">-p 8081:80 \</span><br><span class="line">--<span class="built_in">link</span> ldap \</span><br><span class="line">--name suiyue_pla \</span><br><span class="line">--<span class="built_in">env</span> PHPLDAPADMIN_HTTPS=<span class="literal">false</span> \</span><br><span class="line">--<span class="built_in">env</span> PHPLDAPADMIN_LDAP_HOSTS=ldap \</span><br><span class="line">--restart always \</span><br><span class="line">--detach osixia/phpldapadmin</span><br></pre></td></tr></table></figure>

<h5 id="浏览器访问-8081端口"><a href="#浏览器访问-8081端口" class="headerlink" title="浏览器访问 8081端口"></a>浏览器访问 8081端口</h5><blockquote>
<p>用户名:	cn&#x3D;admin,dc&#x3D;example,dc&#x3D;org</p>
<p>密码:	admin</p>
</blockquote>
<h5 id="接下来需要在界面中配置organization-x2F-user"><a href="#接下来需要在界面中配置organization-x2F-user" class="headerlink" title="接下来需要在界面中配置organization &#x2F; user"></a>接下来需要在界面中配置organization &#x2F; user</h5><ul>
<li>create a child entry</li>
<li>posix group 是组织     user  account 是用户    够用了</li>
<li>用户登录使用用户名  密码即可登录</li>
</ul>
<h2 id="LDAP-名词解释"><a href="#LDAP-名词解释" class="headerlink" title="LDAP 名词解释"></a>LDAP 名词解释</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dn - CN, OU, DC 都是 LDAP 连接服务器的端字符串中的区别名称（DN, distinguished   name） </span><br><span class="line">o – organization（组织-公司）</span><br><span class="line">ou – organization unit（组织单元-部门）</span><br><span class="line">c - countryName（国家）</span><br><span class="line">dc - domainComponent（域名）</span><br><span class="line">sn – suer name（真实名称）</span><br><span class="line">cn - common name（常用名称</span><br></pre></td></tr></table></figure>

<h2 id="Gitea配置"><a href="#Gitea配置" class="headerlink" title="Gitea配置"></a>Gitea配置</h2> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 配置认证源</span><br><span class="line">2. 认证类型 LDAP (via BindDN)</span><br><span class="line">3. 安全协议  Unencrypted</span><br><span class="line">4. 主机端口  :       xxx:389</span><br><span class="line">5. 绑定一个可以获取所有用户组织的的角色账号</span><br><span class="line">6. **用户搜索基准  cn=nancal,dc=example,dc=org**</span><br><span class="line">7. **用户过滤规则    (&amp;(objectClass=posixAccount)(uid=%s))**</span><br><span class="line">8. 电子邮箱属性    Email</span><br></pre></td></tr></table></figure>

<h3 id="Jenkins配置-不能和数据库用户共存-使用之后之前的用户不能登录"><a href="#Jenkins配置-不能和数据库用户共存-使用之后之前的用户不能登录" class="headerlink" title="Jenkins配置  不能和数据库用户共存(使用之后之前的用户不能登录)"></a>Jenkins配置  不能和数据库用户共存(使用之后之前的用户不能登录)</h3> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. Server :       ldap://xxx.xx:389</span><br><span class="line">2. user  search base :      cn=nancal,dc=example,dc=org</span><br><span class="line">3. user  search  filter :   uid=&#123;0&#125;</span><br><span class="line">4. group search base :   cn=nancal,dc=example,dc=org</span><br><span class="line">5. Manager DN / Password :  管理员的用户名密码</span><br><span class="line">6. Test LDAP setting</span><br></pre></td></tr></table></figure>

<h3 id="Harbor-可以配置"><a href="#Harbor-可以配置" class="headerlink" title="Harbor  可以配置"></a>Harbor  可以配置</h3><blockquote>
<p>要开启Harbor的ldap认证功能就必须要在安装完，并启动服务后变更一下认证源。如果没有变更，就添加了用户就没有办法去修改配置变更了</p>
</blockquote>
<h6 id="Grafana-修改配置文件"><a href="#Grafana-修改配置文件" class="headerlink" title="Grafana  修改配置文件"></a>Grafana  修改配置文件</h6><h6 id="Yapi-需要修改docker-启动配置"><a href="#Yapi-需要修改docker-启动配置" class="headerlink" title="Yapi 需要修改docker 启动配置"></a>Yapi 需要修改docker 启动配置</h6><h6 id="Kuboard-v3版本-支持-我们使用的是v2版本"><a href="#Kuboard-v3版本-支持-我们使用的是v2版本" class="headerlink" title="Kuboard v3版本 支持,我们使用的是v2版本"></a>Kuboard v3版本 支持,我们使用的是v2版本</h6><h6 id="Zentao-需要专业版支持-开源版插件支持到7-3版本"><a href="#Zentao-需要专业版支持-开源版插件支持到7-3版本" class="headerlink" title="Zentao 需要专业版支持 , 开源版插件支持到7.3版本"></a>Zentao 需要专业版支持 , 开源版插件支持到7.3版本</h6><h6 id="Sonarqube-8-0版本后不支持"><a href="#Sonarqube-8-0版本后不支持" class="headerlink" title="Sonarqube 8.0版本后不支持"></a>Sonarqube 8.0版本后不支持</h6><hr>
<h2 id="Java的LDAP连接与关键接口"><a href="#Java的LDAP连接与关键接口" class="headerlink" title="Java的LDAP连接与关键接口"></a>Java的LDAP连接与关键接口</h2><h5 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--LDAP--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-ldap&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h5 id="application-yml-文件配置"><a href="#application-yml-文件配置" class="headerlink" title="application.yml 文件配置"></a>application.yml 文件配置</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">ldap:</span></span><br><span class="line">    <span class="attr">urls:</span> <span class="string">ldap://47.xxx.37.xx:389</span></span><br><span class="line">    <span class="attr">base:</span> <span class="string">dc=example,dc=org</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">cn=admin,dc=example,dc=org</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br></pre></td></tr></table></figure>

<h5 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">// 实体</span></span><br><span class="line"><span class="meta">@Cn(<span class="string">&quot;LDAP用户&quot;</span>)</span></span><br><span class="line"><span class="meta">@Document</span></span><br><span class="line"><span class="meta">@DbEntityGroup(<span class="string">&quot;corp&quot;</span>)</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">LDAPUser</span>(</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;用户姓名&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;cn&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> userName: String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;真实姓名&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;sn&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> realName: String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;密码&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;userpassword&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> userPassword:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;uidnumber&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;uidnumber&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> uidnumber:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;gidnumber&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;gidnumber&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> gidnumber:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;uid&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;uid&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> uid:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;homedirectory&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;homedirectory&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> homedirectory:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可选信息</span></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;性别&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;sex&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> sex: String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;手机号&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;mobile&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> mobile: String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cn(<span class="string">&quot;邮件&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Attribute(name = <span class="string">&quot;email&quot;</span>)</span></span><br><span class="line">    <span class="keyword">var</span> email: String = <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">) : BaseEntity(), IMongoDocument</span><br></pre></td></tr></table></figure>

<h5 id="CRUD-等简单的接口"><a href="#CRUD-等简单的接口" class="headerlink" title="CRUD 等简单的接口"></a>CRUD 等简单的接口</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xx.web.corp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by CodeGenerator @2020-04-24 11:17:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Api(description = <span class="string">&quot;Corporation&quot;</span>, tags = arrayOf(<span class="string">&quot;Corporation&quot;</span>))</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@JsonpMapping(<span class="string">&quot;/open/ldap&quot;</span>)</span></span><br><span class="line"><span class="meta">@OpenAction</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LDAP_Controller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(<span class="string">&quot;\$&#123;spring.ldap.base&#125;&quot;</span>)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> base: String? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(<span class="string">&quot;\$&#123;spring.ldap.urls&#125;&quot;</span>)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> url: String? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(<span class="string">&quot;\$&#123;spring.ldap.username&#125;&quot;</span>)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> dn: String? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(<span class="string">&quot;\$&#123;spring.ldap.password&#125;&quot;</span>)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> pwd: String? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">var</span> ldapTemplate:LdapTemplate?=<span class="literal">null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonpMapping(<span class="string">&quot;/allUserName&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getAllUserName</span><span class="params">()</span></span>:Any&#123;</span><br><span class="line">        <span class="keyword">val</span> res = ldapTemplate!!.search(</span><br><span class="line">            query().<span class="keyword">where</span>(<span class="string">&quot;objectclass&quot;</span>).`<span class="keyword">is</span>`(<span class="string">&quot;person&quot;</span>),</span><br><span class="line">            AttributesMapper &#123; attrs: Attributes -&gt;</span><br><span class="line">                attrs[<span class="string">&quot;cn&quot;</span>].<span class="keyword">get</span>() <span class="keyword">as</span> String</span><br><span class="line">            &#125; <span class="keyword">as</span> AttributesMapper&lt;*&gt;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonpMapping(<span class="string">&quot;/allUser&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getUser</span><span class="params">()</span></span>: ApiResult&lt;List&lt;LDAPUser&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = ldapTemplate!!.search(</span><br><span class="line">            query()</span><br><span class="line">                .<span class="keyword">where</span>(<span class="string">&quot;objectclass&quot;</span>).`<span class="keyword">is</span>`(<span class="string">&quot;person&quot;</span>), LdapUserMapper()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ApiResult.of(<span class="keyword">data</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//在ldap中，有两个&quot;查询&quot;概念，search和lookup。search是ldaptemplate对每一个entry进行查询，lookup是通过DN直接找到某个条目。</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据DN查询指定人员信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dn    e.g:   如果用户在 cn=nancal,dc=example,dc=org下</span></span><br><span class="line"><span class="comment">     *                      具体到某一个人   需要传入的是  cn=c y,cn=nancal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonpMapping(<span class="string">&quot;/userByDn&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">findPersonWithDn</span><span class="params">(dn: <span class="type">String</span>)</span></span>:ApiResult&lt;LDAPUser&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResult.of(ldapTemplate!!.lookup(dn, LdapUserMapper()))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonpMapping(<span class="string">&quot;/checkPassword&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">check</span><span class="params">(username:<span class="type">String</span>,password:<span class="type">String</span>)</span></span>:JsonResult&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> filter = AndFilter()</span><br><span class="line">        filter.and(EqualsFilter(<span class="string">&quot;objectclass&quot;</span>, <span class="string">&quot;person&quot;</span>)).and(EqualsFilter(<span class="string">&quot;cn&quot;</span>, username))</span><br><span class="line">        <span class="keyword">val</span> flag = ldapTemplate!!.authenticate(DistinguishedName.EMPTY_PATH, filter.toString(), password)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">            println(<span class="string">&quot;用户:<span class="variable">$username</span> 验证密码通过&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> JsonResult()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResult(<span class="string">&quot;密码错误,请重新输入&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonpMapping(<span class="string">&quot;/user/add&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">addUser</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@JsonModel</span> user:<span class="type">LDAPUser</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        dept:<span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>:JsonResult&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> ocAttr = BasicAttribute(<span class="string">&quot;objectclass&quot;</span>)</span><br><span class="line"></span><br><span class="line">        ocAttr.add(<span class="string">&quot;top&quot;</span>);</span><br><span class="line">        ocAttr.add(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">        ocAttr.add(<span class="string">&quot;inetOrgPerson&quot;</span>);</span><br><span class="line">        ocAttr.add(<span class="string">&quot;organizationalPerson&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> attrs: Attributes = BasicAttributes()</span><br><span class="line"></span><br><span class="line">        attrs.put(ocAttr);</span><br><span class="line">        attrs.put(<span class="string">&quot;cn&quot;</span>, user.userName);</span><br><span class="line">        attrs.put(<span class="string">&quot;sn&quot;</span>, user.realName);</span><br><span class="line">        attrs.put(<span class="string">&quot;displayName&quot;</span>, user.userName);</span><br><span class="line">        attrs.put(<span class="string">&quot;mail&quot;</span>, user.email);</span><br><span class="line">        attrs.put(<span class="string">&quot;mobile&quot;</span>, user.mobile);</span><br><span class="line">        attrs.put(<span class="string">&quot;userPassword&quot;</span>, user.userPassword)</span><br><span class="line"></span><br><span class="line">        ldapTemplate!!.bind(<span class="string">&quot;cn=<span class="subst">$&#123;user.userName&#125;</span>,cn=<span class="variable">$dept</span>&quot;</span>,<span class="literal">null</span>,attrs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonResult()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//username 不可修改</span></span><br><span class="line">    <span class="meta">@JsonpMapping(<span class="string">&quot;/user/update&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@JsonModel</span> user:<span class="type">LDAPUser</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        dept:<span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>:JsonResult&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ldapTemplate!!.modifyAttributes(<span class="string">&quot;cn=<span class="subst">$&#123;user.userName&#125;</span>,cn=<span class="variable">$dept</span>&quot;</span>, arrayOf(</span><br><span class="line">                ModificationItem(DirContext.REPLACE_ATTRIBUTE, BasicAttribute(<span class="string">&quot;sn&quot;</span>, user.realName)),</span><br><span class="line">                ModificationItem(DirContext.REPLACE_ATTRIBUTE, BasicAttribute(<span class="string">&quot;mail&quot;</span>, user.email)),</span><br><span class="line">                ModificationItem(DirContext.REPLACE_ATTRIBUTE, BasicAttribute(<span class="string">&quot;mobile&quot;</span>, user.mobile)),</span><br><span class="line">                ModificationItem(DirContext.REPLACE_ATTRIBUTE, BasicAttribute(<span class="string">&quot;userPassword&quot;</span>, user.userPassword))</span><br><span class="line">            ))</span><br><span class="line">        &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">            <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;修改失败,请重试: <span class="subst">$&#123;e.printStackTrace()&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonResult()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonpMapping(<span class="string">&quot;/user/delete&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        dept:<span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>:JsonResult&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ldapTemplate!!.unbind(<span class="string">&quot;cn=<span class="subst">$&#123;name&#125;</span>,cn=<span class="variable">$dept</span>&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">            <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;删除用户失败,请确认后重试&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonResult()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">LdapUserMapper</span> : <span class="type">AttributesMapper</span>&lt;<span class="type">LDAPUser</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Throws(NamingException::class)</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">mapFromAttributes</span><span class="params">(attrs: <span class="type">Attributes</span>)</span></span>: LDAPUser &#123;</span><br><span class="line">            <span class="keyword">val</span> ldapUser = LDAPUser()</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                ldapUser.userName = attrs[<span class="string">&quot;cn&quot;</span>].<span class="keyword">get</span>() <span class="keyword">as</span> String</span><br><span class="line">                ldapUser.realName = attrs[<span class="string">&quot;sn&quot;</span>].<span class="keyword">get</span>() <span class="keyword">as</span> String</span><br><span class="line"></span><br><span class="line">                <span class="keyword">val</span> bytes = attrs[<span class="string">&quot;userPassword&quot;</span>].<span class="keyword">get</span>() <span class="keyword">as</span> ByteArray</span><br><span class="line"></span><br><span class="line">                ldapUser.userPassword = String(bytes).replace(<span class="string">&quot;&#123;MD5&#125;&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">                ldapUser.gidnumber = attrs[<span class="string">&quot;gidnumber&quot;</span>].<span class="keyword">get</span>() <span class="keyword">as</span> String</span><br><span class="line">                ldapUser.uidnumber = attrs[<span class="string">&quot;uidnumber&quot;</span>].<span class="keyword">get</span>() <span class="keyword">as</span> String</span><br><span class="line">                ldapUser.uid = attrs[<span class="string">&quot;uid&quot;</span>].<span class="keyword">get</span>() <span class="keyword">as</span> String</span><br><span class="line">            &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">                <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;用户查询错误,请检查对应的dn是否正确&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ldapUser</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="附录-错误码"><a href="#附录-错误码" class="headerlink" title="附录:  (错误码)"></a>附录:  (错误码)</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">LDAP_SUCCESS = 0 //成功</span><br><span class="line"></span><br><span class="line">LDAP_OPERATIONS_ERROR = 1 //操作错误</span><br><span class="line"></span><br><span class="line">LDAP_PROTOCOL_ERROR = 2 //协议错误</span><br><span class="line"></span><br><span class="line">LDAP_TIME_LIMIT_EXCEEDED = 3 //超过最大时间限制</span><br><span class="line"></span><br><span class="line">LDAP_SIZE_LIMIT_EXCEEDED = 4 //超过最大返回条目数</span><br><span class="line"></span><br><span class="line">LDAP_COMPARE_FALSE = 5 //比较不匹配</span><br><span class="line"></span><br><span class="line">LDAP_COMPARE_TRUE = 6 //比较匹配</span><br><span class="line"></span><br><span class="line">LDAP_AUTH_METHOD_NOT_SUPPORTED = 7 //认证方法未被支持</span><br><span class="line"></span><br><span class="line">LDAP_STRONG_AUTH_REQUIRED = 8 //需要强认证</span><br><span class="line"></span><br><span class="line">LDAP_PARTIAL_RESULTS = 9 //null</span><br><span class="line"></span><br><span class="line">LDAP_REFERRAL = 10 //Referral</span><br><span class="line"></span><br><span class="line">LDAP_ADMIN_LIMIT_EXCEEDED = 11 //超出管理员权限</span><br><span class="line"></span><br><span class="line">LDAP_UNAVAILABLE_CRITICAL_EXTENSION = 12 //Critical扩展无效</span><br><span class="line"></span><br><span class="line">LDAP_CONFIDENTIALITY_REQUIRED = 13 //需要Confidentiality</span><br><span class="line"></span><br><span class="line">LDAP_SASL_BIND_IN_PROGRESS = 14 //需要SASL绑定</span><br><span class="line"></span><br><span class="line">LDAP_NO_SUCH_ATTRIBUTE = 16 //未找到该属性</span><br><span class="line"></span><br><span class="line">LDAP_UNDEFINED_ATTRIBUTE_TYPE = 17 //未定义的属性类型</span><br><span class="line"></span><br><span class="line">LDAP_INAPPROPRIATE_MATCHING = 18 //不适当的匹配</span><br><span class="line"></span><br><span class="line">LDAP_CONSTRAINT_VIOLATION = 19 //约束冲突</span><br><span class="line"></span><br><span class="line">LDAP_ATTRIBUTE_OR_value_EXISTS = 20 //属性或值已存在</span><br><span class="line"></span><br><span class="line">LDAP_INVALID_ATTRIBUTE_SYNTAX = 21 //无效的属性语法</span><br><span class="line"></span><br><span class="line">LDAP_NO_SUCH_OBJECT = 32 //未找到该对象</span><br><span class="line"></span><br><span class="line">LDAP_ALIAS_PROBLEM = 33 //别名有问题</span><br><span class="line"></span><br><span class="line">LDAP_INVALID_DN_SYNTAX = 34 //无效的DN语法</span><br><span class="line"></span><br><span class="line">LDAP_IS_LEAF = 35 //null</span><br><span class="line"></span><br><span class="line">LDAP_ALIAS_DEREFERENCING_PROBLEM = 36 //Dereference别名有问题</span><br><span class="line"></span><br><span class="line">LDAP_INAPPROPRIATE_AUTHENTICATION = 48 //不适当的认证</span><br><span class="line"></span><br><span class="line">LDAP_INVALID_CREDENTIALS = 49 //无效的Credential</span><br><span class="line"></span><br><span class="line">LDAP_INSUFFICIENT_ACCESS_RIGHTS = 50 //访问权限不够</span><br><span class="line"></span><br><span class="line">LDAP_BUSY = 51 //遇忙</span><br><span class="line"></span><br><span class="line">LDAP_UNAVAILABLE = 52 //无效</span><br><span class="line"></span><br><span class="line">LDAP_UNWILLING_TO_PERform = 53 //意外问题</span><br><span class="line"></span><br><span class="line">LDAP_LOOP_DETECT = 54 //发现死循环</span><br><span class="line"></span><br><span class="line">LDAP_NAMING_VIOLATION = 64 //命名冲突</span><br><span class="line"></span><br><span class="line">LDAP_OBJECT_CLASS_VIOLATION = 65 //对象类冲突</span><br><span class="line"></span><br><span class="line">LDAP_NOT_ALLOWED_ON_NON_LEAF = 66 //不允许在非叶结点执行此操作</span><br><span class="line"></span><br><span class="line">LDAP_NOT_ALLOWED_ON_RDN = 67 //不允许对RDN执行此操作</span><br><span class="line"></span><br><span class="line">LDAP_ENTRY_ALREADY_EXISTS = 68 //Entry已存在</span><br><span class="line"></span><br><span class="line">LDAP_OBJECT_CLASS_MODS_PROHIBITED = 69 //禁止更改对象类</span><br><span class="line"></span><br><span class="line">LDAP_AFFECTS_MULTIPLE_DSAS = 71 //null</span><br><span class="line"></span><br><span class="line">LDAP_OTHER = 80 //其它</span><br><span class="line"></span><br><span class="line">再来一份十六进制的，大家对照吧。</span><br><span class="line"></span><br><span class="line">下面是winldap.h文件中的定义的十六进制错误码，我给其中的绝大部分加上了从活动目录的书上看的汉语说明，。</span><br><span class="line"></span><br><span class="line">typedef enum</span><br><span class="line"></span><br><span class="line">Unknown macro: &#123;</span><br><span class="line"></span><br><span class="line">LDAP_SUCCESS = 0x00,//操作成功</span><br><span class="line"></span><br><span class="line">LDAP_OPERATIONS_ERROR = 0x01,//一个未指定的错误发生在处理LDAP请求的服务器上</span><br><span class="line"></span><br><span class="line">LDAP_PROTOCOL_ERROR = 0x02,//服务器接受到一个没有正确格式化或顺序出错的包</span><br><span class="line"></span><br><span class="line">LDAP_TIMELIMIT_EXCEEDED = 0x03,//操作上指定的时间限制被超出。这不同于服务器没有及时响应时的客户方检测到的超时错误</span><br><span class="line"></span><br><span class="line">LDAP_SIZELIMIT_EXCEEDED = 0x04,//搜索返回的项数超过了管理限制或请求限制</span><br><span class="line"></span><br><span class="line">LDAP_COMPARE_FALSE = 0x05,//LDAP比较函数(例如ldap_compare())返回FALSE</span><br><span class="line"></span><br><span class="line">LDAP_COMPARE_TRUE = 0x06,//LDAP比较函数(例如ldap_compare())返回TRUE</span><br><span class="line"></span><br><span class="line">LDAP_AUTH_METHOD_NOT_SUPPORTED = 0x07,//绑定(bind)操作中(例如ldap_bind())请求的认证方法不被服务器支持。如果你使用一个非微软LDAP客户与活动目录通信，这种情况可能发生</span><br><span class="line"></span><br><span class="line">LDAP_STRONG_AUTH_REQUIRED = 0x08,//服务器要求一个字符串认证方法而不是一个简单口令</span><br><span class="line"></span><br><span class="line">LDAP_REFERRAL_V2 = 0x09,//搜索结果包含LDAPv2引用或者一个部分结果集</span><br><span class="line"></span><br><span class="line">LDAP_PARTIAL_RESULTS = 0x09,</span><br><span class="line"></span><br><span class="line">LDAP_REFERRAL = 0x0a,//请求操作必须由另一个拥有适当的命名上下文备份的服务器处理</span><br><span class="line"></span><br><span class="line">LDAP_ADMIN_LIMIT_EXCEEDED = 0x0b,//管理限制被超出。例如，搜索操作花费的时间超出了服务器所允许的最大时间</span><br><span class="line"></span><br><span class="line">LDAP_UNAVAILABLE_CRIT_EXTENSION = 0x0c,//客户请求一个LDAP扩展并且指示该扩展是关键的，但是服务器并不支持扩展</span><br><span class="line"></span><br><span class="line">LDAP_CONFIDENTIALITY_REQUIRED = 0x0d,//操作要求某种级别的加密</span><br><span class="line"></span><br><span class="line">LDAP_SASL_BIND_IN_PROGRESS = 0x0e,//当一个SASL绑定(bind)已经在客户处理过程中时，请求一个绑定(bind)操作</span><br><span class="line"></span><br><span class="line">LDAP_NO_SUCH_ATTRIBUTE = 0x10,//客户尝试修改或者删除一个并不存在的项的一个属性</span><br><span class="line"></span><br><span class="line">LDAP_UNDEFINED_TYPE = 0x11,//未定义的类型</span><br><span class="line"></span><br><span class="line">LDAP_INAPPROPRIATE_MATCHING = 0x12,//提供的匹配规则对搜索不合适或者对于属性不合适</span><br><span class="line"></span><br><span class="line">LDAP_CONSTRAINT_VIOLATION = 0x13,//客户请求一个将违背目录中语义约束的操作。一个经常的原因是不合适的改变了模式--例如当添加一个新类时提供了一个重复的OID(对象识别符)</span><br><span class="line"></span><br><span class="line">LDAP_ATTRIBUTE_OR_value_EXISTS = 0x14,//客户尝试添加一个已经存在的属性或值</span><br><span class="line"></span><br><span class="line">LDAP_INVALID_SYNTAX = 0x15,//搜索过滤器的语法无效</span><br><span class="line"></span><br><span class="line">LDAP_NO_SUCH_OBJECT = 0x20,//客户尝试或者删除一个在目录中并不存在的项</span><br><span class="line"></span><br><span class="line">LDAP_ALIAS_PROBLEM = 0x21,//服务器在处理别名时遇到了一个错误</span><br><span class="line"></span><br><span class="line">LDAP_INVALID_DN_SYNTAX = 0x22,//请求中指定的可区别名字的格式无效</span><br><span class="line"></span><br><span class="line">LDAP_IS_LEAF = 0x23,//函数中指定的项是目录树中的一个叶子项</span><br><span class="line"></span><br><span class="line">LDAP_ALIAS_DEREF_PROBLEM = 0x24,//在解除对一个别名的引用时服务器遇到了一个错误。例如，目的项并不存在</span><br><span class="line"></span><br><span class="line">LDAP_INAPPROPRIATE_AUTH = 0x30,//认证级别对于操作不足</span><br><span class="line"></span><br><span class="line">LDAP_INVALID_CREDENTIALS = 0x31,//绑定(bind)请求中提供的证书是无效的--例如一个无效的口令</span><br><span class="line"></span><br><span class="line">LDAP_INSUFFICIENT_RIGHTS = 0x32,//没有执行该操作所需的足够的访问权限</span><br><span class="line"></span><br><span class="line">LDAP_BUSY = 0x33,//服务器太忙碌而无法服务该请求。稍后重新尝试</span><br><span class="line"></span><br><span class="line">LDAP_UNAVAILABLE = 0x34,//目录服务暂不可用。稍后重新尝试</span><br><span class="line"></span><br><span class="line">LDAP_UNWILLING_TO_PERform = 0x35,//由于管理策略约束方面的原因，服务器将不支持该操作--例如，如果在模式修改没有被允许或者没有连接到模式管理器的情况下，试图修改该模式</span><br><span class="line"></span><br><span class="line">LDAP_LOOP_DETECT = 0x36,//在追踪引用的过程中，客户引用到它以前已经引用的服务器</span><br><span class="line"></span><br><span class="line">LDAP_SORT_CONTROL_MISSING = 0x3C,</span><br><span class="line"></span><br><span class="line">LDAP_OFFSET_RANGE_ERROR = 0x3D,</span><br><span class="line"></span><br><span class="line">LDAP_NAMING_VIOLATION = 0x40,//客户指定了一个不正确的对象的可区别名字</span><br><span class="line"></span><br><span class="line">LDAP_OBJECT_CLASS_VIOLATION = 0x41,//操作违背了类定义中定义的语义规则</span><br><span class="line"></span><br><span class="line">LDAP_NOT_ALLOWED_ON_NONLEAF = 0x42,//所请求的操作只可能在一个叶子对象(非容器)上执行</span><br><span class="line"></span><br><span class="line">LDAP_NOT_ALLOWED_ON_RDN = 0x43,//在相对可区别名字上不允许该操作</span><br><span class="line"></span><br><span class="line">LDAP_ALREADY_EXISTS = 0x44,//客户试图添加一个已经存在的对象</span><br><span class="line"></span><br><span class="line">LDAP_NO_OBJECT_CLASS_MODS = 0x45,//客户试图通过改变一个对象的objectClass属性来修改对象的类</span><br><span class="line"></span><br><span class="line">LDAP_RESULTS_TOO_LARGE = 0x46,//搜索操作的结果集太大，服务器无法处理</span><br><span class="line"></span><br><span class="line">LDAP_AFFECTS_MULTIPLE_DSAS = 0x47,//所请求的操作将影响多个DSA--例如，在一个子树包含一个下级引用，该引用指向另一个命名上下文的情况下，删除该子树将影响多个DSA(目录服务器代理)</span><br><span class="line"></span><br><span class="line">LDAP_VIRTUAL_LIST_VIEW_ERROR = 0x4c,</span><br><span class="line"></span><br><span class="line">LDAP_OTHER = 0x50,//发生了一些其他的LDAP错误</span><br><span class="line"></span><br><span class="line">LDAP_SERVER_DOWN = 0x51,//LDAP服务器已关闭</span><br><span class="line"></span><br><span class="line">LDAP_LOCAL_ERROR = 0x52,//客户发生了其他一些未指定的错误</span><br><span class="line"></span><br><span class="line">LDAP_ENCODING_ERROR = 0x53,//在将一个LDAP请求编码为ASN.1的过程中发生了一个错误</span><br><span class="line"></span><br><span class="line">LDAP_DECODING_ERROR = 0x54,//从服务器接受到的ASN.1编码的数据是无效的</span><br><span class="line"></span><br><span class="line">LDAP_TIMEOUT = 0x55,//在指定的时间内服务器不能响应客户</span><br><span class="line"></span><br><span class="line">LDAP_AUTH_UNKNOWN = 0x56,//在绑定(bind)请求中指定了一种未知的认证机制</span><br><span class="line"></span><br><span class="line">LDAP_FILTER_ERROR = 0x57,//搜索过滤器出现了某种错误</span><br><span class="line"></span><br><span class="line">LDAP_USER_CANCELLED = 0x58,//用户取消了操作</span><br><span class="line"></span><br><span class="line">LDAP_PARAM_ERROR = 0x59,//函数中指定的某个参数出现了错误。例如，向一个LDAP API函数传递一个NULL指针，但该函数并不希望这样，在这种情况下就产生该错误</span><br><span class="line"></span><br><span class="line">LDAP_NO_MEMORY = 0x5a,//客户试图分配内存并且失败了</span><br><span class="line"></span><br><span class="line">LDAP_CONNECT_ERROR = 0x5b,//客户试图向服务器建立一个TCP连接并且失败了</span><br><span class="line"></span><br><span class="line">LDAP_NOT_SUPPORTED = 0x5c,//所请求的操作不被这种版本的LDAP协议所支持</span><br><span class="line"></span><br><span class="line">LDAP_NO_RESULTS_RETURNED = 0x5e,//从服务器接受到一个响应，但是它没有包含结果</span><br><span class="line"></span><br><span class="line">LDAP_CONTROL_NOT_FOUND = 0x5d,//从服务器接受到的数据表明有一个LDAP控制出现但是在数据中没有找到一个LDAP控制</span><br><span class="line"></span><br><span class="line">LDAP_MORE_RESULTS_TO_RETURN = 0x5f,//因为有太多的结果，所以客户无法检索</span><br><span class="line"></span><br><span class="line">LDAP_CLIENT_LOOP = 0x60,//在处理引用时客户检测到一个循环</span><br><span class="line"></span><br><span class="line">引用数目超过了限制</span><br><span class="line"></span><br><span class="line">LDAP_REFERRAL_LIMIT_EXCEEDED = 0x61//客户追踪的</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2021/01/11/Sonarqube%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/11/Sonarqube%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Sonarqube的使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-11 16:55:18" itemprop="dateCreated datePublished" datetime="2021-01-11T16:55:18+08:00">2021-01-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>749</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Sonarqube的使用"><a href="#Sonarqube的使用" class="headerlink" title="Sonarqube的使用"></a>Sonarqube的使用</h2><blockquote>
<p>在Sonarqube中安装Java 语言检查的插件 ,顺便安装Chinese</p>
<p>在Idea上安装 SonarLint 插件</p>
</blockquote>
<h5 id="在Sonarqube上"><a href="#在Sonarqube上" class="headerlink" title="在Sonarqube上"></a>在Sonarqube上</h5><ol>
<li>安装Chinese Pack 插件</li>
<li>安装CheckStyle 等对应语言的插件</li>
<li>创建项目,并获得一个令牌,在Idea中配置使用</li>
<li>项目语言 Java -&gt; Maven</li>
<li>使用mvn 命令对代码进行扫描</li>
</ol>
<h5 id="在Idea上"><a href="#在Idea上" class="headerlink" title="在Idea上"></a>在Idea上</h5><ol>
<li>安装插件  SonarLint</li>
<li>配置 SonarLint  General Settings  &#x2F;  ✔  Automatically tigger analysis &#x2F;  配置 sonarqube的地址</li>
<li>配置token</li>
<li>配置 SonarLint  Project Settings   &#x2F;  关联sonarqube服务与项目</li>
<li>执行mvn   命令</li>
</ol>
<h5 id="手动安装插件"><a href="#手动安装插件" class="headerlink" title="手动安装插件"></a>手动安装插件</h5><ol>
<li><p>插件地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://binaries.sonarsource.com/Distribution/</span><br></pre></td></tr></table></figure>
</li>
<li><p>上传到$SONARQUBE-HOME&#x2F;extensions&#x2F;downloads目录中、记得要重启sonarqube服务器</p>
</li>
</ol>
<h5 id="启动检测"><a href="#启动检测" class="headerlink" title="启动检测"></a>启动检测</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- opcua  dev</span><br><span class="line">    </span><br><span class="line">mvn sonar:sonar  -Dsonar.projectKey=opc -Dsonar.host.url=http://xxxx.xxx.com:31006  -Dsonar.login=3e8e4ba567b8b4dd547727cxxxxx3bc3d1404</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- devops_corp  dev</span><br><span class="line"></span><br><span class="line">mvn sonar:sonar -Dsonar.projectKey=devops_crop -Dsonar.host.url=http://xxx.xx.com:31006 -Dsonar.login=304010fd0c77a8a4c9054xxxxxxxx3</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2021/01/04/%E7%A6%85%E9%81%93%E7%9A%84%E9%9B%86%E6%88%90%E6%B3%A8%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/04/%E7%A6%85%E9%81%93%E7%9A%84%E9%9B%86%E6%88%90%E6%B3%A8%E5%86%8C/" class="post-title-link" itemprop="url">禅道的集成注册</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-04 18:56:17" itemprop="dateCreated datePublished" datetime="2021-01-04T18:56:17+08:00">2021-01-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="禅道的集成注册"><a href="#禅道的集成注册" class="headerlink" title="禅道的集成注册"></a>禅道的集成注册</h4><blockquote>
<p>zentao其实我感觉,没必要前端把密码加密了啊,为什么会这么做呢?前端没事干嘛?</p>
<p>参考资料:<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4f3fa26c8dc3?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation">https://www.jianshu.com/p/4f3fa26c8dc3?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">官方示例中提示需要解包两次json</span></span><br><span class="line"><span class="string">$result = file_get_contents(&#x27;http://pms.zentao.net/project-task-8.json&#x27;); </span></span><br><span class="line"><span class="string">$result = json_decode($result);</span></span><br><span class="line"><span class="string">if($result-&gt;status == &#x27;success&#x27; and md5($result-&gt;data) == $result-&gt;md5)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    $data = json_decode($result-&gt;data);</span></span><br><span class="line"><span class="string">    print_r($data);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Zentao</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host, account, password</span>):</span><br><span class="line">        self.host = host</span><br><span class="line">        self.session_id = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        self.params = &#123;&#125;</span><br><span class="line">        self.account = account</span><br><span class="line">        self.password = password</span><br><span class="line"></span><br><span class="line">        self._get_session_id()</span><br><span class="line">        self.login()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_session_id</span>(<span class="params">self</span>):</span><br><span class="line">        api_path = <span class="string">&quot;/zentao/api-getsessionid.json&quot;</span></span><br><span class="line">        response = requests.get(self.host + api_path)</span><br><span class="line">        result = self._get_zentao_result(response.json())</span><br><span class="line">        self.session_id = result[<span class="string">&#x27;sessionID&#x27;</span>]</span><br><span class="line">        self.params[result[<span class="string">&#x27;sessionName&#x27;</span>]] = self.session_id</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self</span>):</span><br><span class="line">        api_path = <span class="string">&#x27;/zentao/user-login.json&#x27;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;account&#x27;</span>: self.account,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: self.password,</span><br><span class="line">        &#125;</span><br><span class="line">        result = requests.post(self.host + api_path, data=data, params=self.params).json()</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;status&#x27;</span>] == <span class="string">&#x27;success&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;zentao 登陆成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_zentao_result</span>(<span class="params">result</span>):</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;status&#x27;</span>] == <span class="string">&#x27;success&#x27;</span> <span class="keyword">and</span> md5(result[<span class="string">&#x27;data&#x27;</span>].encode()).hexdigest() == result[<span class="string">&#x27;md5&#x27;</span>]:</span><br><span class="line">            data = json.loads(result[<span class="string">&#x27;data&#x27;</span>])</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">zentao_get</span>(<span class="params">self, api_path</span>):</span><br><span class="line">        response = requests.get(self.host + api_path, self.params)</span><br><span class="line">        <span class="comment"># print(response.content)</span></span><br><span class="line">        result = response.json()</span><br><span class="line">        <span class="comment"># print(result)</span></span><br><span class="line">        <span class="keyword">return</span> self._get_zentao_result(result)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">zentao_post</span>(<span class="params">self, api_path, data=<span class="literal">None</span>, json_data=<span class="literal">None</span></span>):</span><br><span class="line">        response = requests.post(self.host + api_path, data=data, json=json_data, params=self.params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._get_zentao_result(response.json())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_dept_list</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        获取部门列表</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        api_path = <span class="string">&quot;/zentao/dept-browse-.json&quot;</span></span><br><span class="line">        data = self.zentao_get(api_path)</span><br><span class="line">        <span class="keyword">return</span> data[<span class="string">&#x27;sons&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">self, account: <span class="built_in">str</span>, password: <span class="built_in">str</span>, realname: <span class="built_in">str</span>, deptid: <span class="built_in">int</span> = <span class="number">7</span>, email: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        创建用户</span></span><br><span class="line"><span class="string">        :param account: 账号</span></span><br><span class="line"><span class="string">        :param password: 密码</span></span><br><span class="line"><span class="string">        :param realname: 真实姓名</span></span><br><span class="line"><span class="string">        :param deptid: 部门编号</span></span><br><span class="line"><span class="string">        :param email: 邮箱</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        api_path = <span class="string">&quot;/zentao/user-create.json&quot;</span>.<span class="built_in">format</span>(deptid)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;dept&quot;</span>: deptid,</span><br><span class="line">            <span class="string">&quot;account&quot;</span>: account,</span><br><span class="line">            <span class="string">&quot;password1&quot;</span>: password,</span><br><span class="line">            <span class="string">&quot;password2&quot;</span>: password,</span><br><span class="line">            <span class="string">&quot;realname&quot;</span>: realname,</span><br><span class="line">            <span class="string">&quot;join&quot;</span>: <span class="built_in">str</span>(datetime.date.today()),</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;dev&quot;</span>,</span><br><span class="line">            <span class="string">&quot;group&quot;</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: email,</span><br><span class="line">            <span class="string">&quot;commiter&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;m&quot;</span>,</span><br><span class="line">            <span class="string">&quot;verifyPassword&quot;</span>: md5((md5(self.password.encode()).hexdigest() + self._get_verify_rand()).encode(</span><br><span class="line"></span><br><span class="line">            )).hexdigest(),</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(self.host + api_path, data=data, params=self.params)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            result = response.json()</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_verify_rand</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&#x27;/zentao/user-create.html&#x27;</span></span><br><span class="line">        html = requests.get(self.host + path, params=self.params).text</span><br><span class="line">        soup = BeautifulSoup(html, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">        value = soup.select_one(<span class="string">&#x27;input#verifyRand&#x27;</span>).attrs[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_user</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    user-delete-[userid].json</span></span><br><span class="line"><span class="string">    verifyPassword: md5(md5(pass)+rand)</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># json_print(dept_browse())</span></span><br><span class="line">    <span class="comment"># print(get_verifyRand())</span></span><br><span class="line">    <span class="comment"># print(create_user(&quot;test2&quot;, &quot;testABC123&quot;, &quot;测试用户&quot;))</span></span><br><span class="line">    <span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">    zentao = Zentao(zentao_host, zentao_account, zentao_password)</span><br><span class="line">    <span class="built_in">print</span>(zentao.get_dept_list())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="其实-用Basic-Auth-直接跳登录的index-可以获取正确的zentaosid"><a href="#其实-用Basic-Auth-直接跳登录的index-可以获取正确的zentaosid" class="headerlink" title="其实,用Basic Auth 直接跳登录的index,可以获取正确的zentaosid"></a>其实,用Basic Auth 直接跳登录的index,可以获取正确的zentaosid</h5><h5 id="添加用户就没有办法了-两个字-太恶心了"><a href="#添加用户就没有办法了-两个字-太恶心了" class="headerlink" title="添加用户就没有办法了, 两个字,太恶心了"></a>添加用户就没有办法了, 两个字,太恶心了</h5><blockquote>
<p>接下来说添加用户的参数,发现每个版本基本都不一样,我用的12.3.3</p>
<p>用户密码加密,使用的password      md5加密 +  rand</p>
<p>管理员密码  md5加密 + rand  再来一层 md5  得到最后的值</p>
</blockquote>
<h4 id="最后怎么实现的呢"><a href="#最后怎么实现的呢" class="headerlink" title="最后怎么实现的呢"></a>最后怎么实现的呢</h4><blockquote>
<p>Jsoup 抓 verifyRand  </p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2021/01/04/%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/04/%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" class="post-title-link" itemprop="url">Mysql简单的定时任务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-04 12:53:16" itemprop="dateCreated datePublished" datetime="2021-01-04T12:53:16+08:00">2021-01-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>334</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="简单的定时任务"><a href="#简单的定时任务" class="headerlink" title="简单的定时任务"></a>简单的定时任务</h4><blockquote>
<p>因为当时着急,没改逻辑 ,直接数据库定时修改值,优秀</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SHOW VARIABLES LIKE &#x27;event_scheduler&#x27;     查看定时任务信息,如果是OFF,需要开启</span><br><span class="line">SET GLOBAL event_scheduler = ON;　      开启定时任务</span><br><span class="line"></span><br><span class="line">use gitea;</span><br><span class="line">delimiter</span><br><span class="line">create procedure set_1 ()</span><br><span class="line">begin</span><br><span class="line">UPDATE user SET must_change_password=0 ;</span><br><span class="line">end</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create event run_event</span><br><span class="line">on schedule every 10 second</span><br><span class="line">on completion preserve enable</span><br><span class="line">do call set_1 ();</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2021/01/01/nginx%E4%BB%A5txt%E6%96%B9%E5%BC%8F%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/01/nginx%E4%BB%A5txt%E6%96%B9%E5%BC%8F%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">nginx以txt方式读取文件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-01 21:13:49" itemprop="dateCreated datePublished" datetime="2021-01-01T21:13:49+08:00">2021-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>169</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="本意是想直接通过url读取日志文件"><a href="#本意是想直接通过url读取日志文件" class="headerlink" title="本意是想直接通过url读取日志文件"></a>本意是想直接通过url读取日志文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       8888;</span><br><span class="line">    server_name  xx.xx.xxx.xx;  </span><br><span class="line">    </span><br><span class="line">    location ~\.(<span class="built_in">log</span>|js|list)&#123;</span><br><span class="line">      	root  /appdata/jd/log/;</span><br><span class="line">		add_header Content-Type text/plain;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2020/12/30/Mendix-K8s-%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/30/Mendix-K8s-%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">Mendix_K8s_部署记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-30 22:11:38" itemprop="dateCreated datePublished" datetime="2020-12-30T22:11:38+08:00">2020-12-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Mendix-K8s-部署记录"><a href="#Mendix-K8s-部署记录" class="headerlink" title="Mendix K8s 部署记录"></a>Mendix K8s 部署记录</h1><h2 id="1-在mendix中生成-mda文件"><a href="#1-在mendix中生成-mda文件" class="headerlink" title="1. 在mendix中生成.mda文件"></a>1. 在mendix中生成.mda文件</h2><ul>
<li>Mendix Studio Pro 中点击 Project–Create Deployment Package</li>
<li>例如，生成了 <code>App.mda</code></li>
<li>将 <code>App.mda</code> 拖入装有docker docker-compose 的 linux 系统中</li>
</ul>
<h2 id="2-Docker-build-制作镜像"><a href="#2-Docker-build-制作镜像" class="headerlink" title="2. Docker build 制作镜像"></a>2. Docker build 制作镜像</h2><ul>
<li><p>提前准备好 <a target="_blank" rel="noopener" href="https://github.com/mendix/docker-mendix-buildpack">https://github.com/mendix/docker-mendix-buildpack</a> 发行版本的源码，解压到docker-mendix-buildpack下</p>
</li>
<li><p>在 <code>docker-mendix-buildpack/</code> 下 解压App.mda到docker-mendix-buildpack&#x2F;build&#x2F;目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip /home/yudong/xxx/App.mda -d build/</span><br></pre></td></tr></table></figure></li>
<li><p>执行 docker build 创建镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build \</span><br><span class="line">  --build-arg BUILD_PATH=build \</span><br><span class="line">--build-arg CF_BUILDPACK=v4.14.1 \</span><br><span class="line">-t mendix/mendix-buildpack:v3.0.2 .</span><br></pre></td></tr></table></figure>
</li>
<li><p>以上版本号可以在 .version 文件中找到 请改成合适的版本</p>
</li>
<li><p>在mysql中提前创建数据库，数据库名 mendix</p>
</li>
<li><p>使用docker run命令启动项目 测试镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it \</span><br><span class="line">-e ADMIN_PASSWORD=Password1! \#超级管理员密码有复杂度要求</span><br><span class="line">-e DATABASE_ENDPOINT=mysql://username:password@databaseurl:port/mendix \</span><br><span class="line">mendix/mendix-buildpack:v3.0.2</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Docker-push-推送镜像"><a href="#Docker-push-推送镜像" class="headerlink" title="Docker push 推送镜像"></a>Docker push 推送镜像</h2><ul>
<li>接下来使用 docker push 推送镜像到镜像管理 harbor 中</li>
<li>首先找到镜像的 image ID</li>
</ul>
<p><code>docker images</code></p>
<ul>
<li>找到如下的镜像<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY                        TAG             IMAGE ID       CREATED             SIZE</span><br><span class="line">mendix/mendix-buildpack           v3.0.2          051c03880e88   About an hour ago   602MB</span><br></pre></td></tr></table></figure></li>
<li>记下IMAGE ID 例如 <code>051c03880e88</code></li>
<li>在 harbor 中提前创建好 mendix 项目</li>
<li>命名镜像 定位镜像在 harbor 仓库中的位置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag  051c03880e88  saas-dev.xxx.com:7002/mendix/mendix-buildpack:1.0</span><br></pre></td></tr></table></figure></li>
<li>推送镜像<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push  saas-dev.xxxx.com:7002/mendix/mendix-buildpack:1.0</span><br></pre></td></tr></table></figure></li>
<li>若找不到 <code>saas-dev.xxxx.com</code> 则修改<code>/etc/hosts</code></li>
<li>在文件最下面一行添加<br><code>101.201.249.217 saas-dev.xxxx.com</code></li>
<li>k8s yaml中直接使用<code>saas-dev.xxxx.com:7002/mendix/mendix-buildpack:1.0 </code>作为镜像名</li>
</ul>
<h2 id="3-在k8s中部署应用"><a href="#3-在k8s中部署应用" class="headerlink" title="3. 在k8s中部署应用"></a>3. 在k8s中部署应用</h2><ul>
<li>在k8s集群的master节点机器下，使用 <code>deployment.yaml</code> 直接部署<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f deployment.yaml</span><br></pre></td></tr></table></figure></li>
<li>测试使用可以注释掉 <code>deployment.yaml</code> 中的LICENSE环境变量<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#- name: LICENSE_ID</span><br><span class="line">#  value: &lt;UUID&gt;</span><br><span class="line">#- name: LICENSE_KEY</span><br><span class="line">#  value: &lt;LICENSE_KEY&gt;</span><br></pre></td></tr></table></figure></li>
<li>正式部署则需要LICENSE ID与KEY 否则只能使用 Trail 试用版</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># deployment.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: mendix</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: mendix</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: mendix</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: mendix</span><br><span class="line">          image: saas-dev.xxxx.com:7002/mendix/mendix-buildpack:1.0</span><br><span class="line">          env:</span><br><span class="line">            - name: ADMIN_PASSWORD</span><br><span class="line">              value: Password1!</span><br><span class="line">            - name: DATABASE_ENDPOINT</span><br><span class="line">              value: mysql://root:1234.5678@mariadb:3306/mendix</span><br><span class="line">            #- name: LICENSE_ID</span><br><span class="line">            #  value: &lt;UUID&gt;</span><br><span class="line">            #- name: LICENSE_KEY</span><br><span class="line">            #  value: &lt;LICENSE_KEY&gt;</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 8080</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: mendix</span><br><span class="line">              mountPath: /data</span><br><span class="line">      volumes:</span><br><span class="line">        - name: mendix</span><br><span class="line">          hostPath:</span><br><span class="line">            path: /mnt/k8s/mendix</span><br><span class="line">            type: DirectoryOrCreate</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: mendix</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">    - name: web</span><br><span class="line">      protocol: TCP</span><br><span class="line">      port: 8080</span><br><span class="line">      targetPort: 8080</span><br><span class="line">      nodePort: 31038</span><br><span class="line">  selector:</span><br><span class="line">    app: mendix</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2020/12/21/openresty%E6%B8%85%E9%99%A4%E5%A4%B4%E4%BF%A1%E6%81%AF-%E4%BD%BFiframe%E5%8F%AF%E4%BB%A5%E6%98%BE%E7%A4%BA%E9%A1%B5%E9%9D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/21/openresty%E6%B8%85%E9%99%A4%E5%A4%B4%E4%BF%A1%E6%81%AF-%E4%BD%BFiframe%E5%8F%AF%E4%BB%A5%E6%98%BE%E7%A4%BA%E9%A1%B5%E9%9D%A2/" class="post-title-link" itemprop="url">openresty清除头信息,使iframe可以显示页面</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-21 23:34:05" itemprop="dateCreated datePublished" datetime="2020-12-21T23:34:05+08:00">2020-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>310</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="主要是这个"><a href="#主要是这个" class="headerlink" title="主要是这个"></a>主要是这个</h4><blockquote>
<p>more_clear_headers</p>
</blockquote>
<p>这个问题主要是因为集成开源的系统,要做统一登录,剑走偏锋</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># harbor</span></span><br><span class="line">server&#123;</span><br><span class="line">  listen 8202;</span><br><span class="line">  more_clear_headers X-Frame-Options Content-Security-Policy;</span><br><span class="line"></span><br><span class="line">  location /dev &#123;</span><br><span class="line">    <span class="built_in">alias</span>  C:\\Users\\think\\WebstormProjects\\portal\\public\\static\\;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">       proxy_pass   http://101.201.xxx.xxx:8202;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2020/12/21/2020-12-21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/21/2020-12-21/" class="post-title-link" itemprop="url">2020-12-21</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-21 23:26:43" itemprop="dateCreated datePublished" datetime="2020-12-21T23:26:43+08:00">2020-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>156</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="今天应该是有意义的一天吧"><a href="#今天应该是有意义的一天吧" class="headerlink" title="今天应该是有意义的一天吧"></a>今天应该是有意义的一天吧</h4><blockquote>
<p>今天,冬至</p>
<p>八点十五下班,赶着时间去永辉超市,买了速冻水饺,凑单了个洗面奶,用了永辉30-15的券</p>
</blockquote>
<h4 id="晚上九点开会"><a href="#晚上九点开会" class="headerlink" title="晚上九点开会"></a>晚上九点开会</h4><blockquote>
<p>毫无意义</p>
</blockquote>
<h4 id="十点"><a href="#十点" class="headerlink" title="十点"></a>十点</h4><blockquote>
<p>感觉疲惫不堪</p>
</blockquote>
<h4 id="十一点半-看了个笑话"><a href="#十一点半-看了个笑话" class="headerlink" title="十一点半,看了个笑话"></a>十一点半,看了个笑话</h4><blockquote>
<p>新冠密接北京案例：<br>上班，开会，吃包子，加班，公交车<br>新冠密接成都案例：<br>打牌，蹦迪，美甲，火锅，茶馆</p>
</blockquote>
<h4 id="现在"><a href="#现在" class="headerlink" title="现在"></a>现在</h4><blockquote>
<p>应该要回去了,不应该在北京呆着了</p>
</blockquote>
<h4 id="累了"><a href="#累了" class="headerlink" title="累了"></a>累了</h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://dev8888.cn/2020/11/26/8%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2ver1-0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/123.jpg">
      <meta itemprop="name" content="Tree">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tree's Technology">
      <meta itemprop="description" content="一个小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Tree's Technology">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/26/8%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2ver1-0/" class="post-title-link" itemprop="url">8系统部署ver1.0</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-26 17:25:01" itemprop="dateCreated datePublished" datetime="2020-11-26T17:25:01+08:00">2020-11-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-14 23:06:02" itemprop="dateModified" datetime="2022-11-14T23:06:02+08:00">2022-11-14</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id=""><a href="#" class="headerlink" title=""></a></h5><h4 id="htop"><a href="#htop" class="headerlink" title="htop"></a>htop</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release -y</span><br><span class="line">yum install htop -y</span><br></pre></td></tr></table></figure>

<h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL http://dev8.cn:8000/static/ops/jdk.sh | bash</span><br></pre></td></tr></table></figure>

<h4 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils  device-mapper-persistent-data  lvm2</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager  --add-repo   https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<h4 id="mySql-root-x2F-1QAZ2wsx"><a href="#mySql-root-x2F-1QAZ2wsx" class="headerlink" title="mySql:  root &#x2F; 1QAZ2wsx"></a>mySql:  root &#x2F; 1QAZ2wsx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -p 3306:3306 --name nksql --net mynet -e MYSQL_ROOT_PASSWORD=1QAZ2wsx -d mysql:5.7</span><br></pre></td></tr></table></figure>

<h4 id="network"><a href="#network" class="headerlink" title="network:"></a>network:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create --subnet=172.72.0.0/16 mynet</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="portainer-io"><a href="#portainer-io" class="headerlink" title="portainer.io"></a>portainer.io</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://101.201.249.217:9000/</span><br></pre></td></tr></table></figure>

<h4 id="Gitea"><a href="#Gitea" class="headerlink" title="Gitea"></a>Gitea</h4><p>访问入口:<a target="_blank" rel="noopener" href="http://101.201.249.217:10080/">http://101.201.249.217:10080/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=gitea -p 10022:22 -p 10080:3000 -v /opt/gitea:/data --net mynet --ip 172.72.0.98 gitea/gitea:1.12.6</span><br><span class="line"></span><br><span class="line">数据库使用:  gitea</span><br></pre></td></tr></table></figure>

<h4 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h4><p>访问入口:  <a target="_blank" rel="noopener" href="http://101.201.249.217:9080/">http://101.201.249.217:9080/</a></p>
<p>管理员用户及密码: admin &#x2F; ad23681eace74ec4985f748f8909aa63</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  -u root \</span><br><span class="line">  -d \</span><br><span class="line">  -p 9080:8080 \</span><br><span class="line">  -p 50000:50000 \</span><br><span class="line">  --name jenkins  -v jenkins-data:/var/jenkins_home \</span><br><span class="line">  jenkins/jenkins:lts</span><br><span class="line">  </span><br><span class="line">访问: http://101.201.249.217:9080/</span><br><span class="line"></span><br><span class="line">进入容器内部获取密码:docker <span class="built_in">exec</span> -it jenkins bash</span><br><span class="line">查看密码: <span class="built_in">cat</span> /var/jenkins_home/secrets/initialAdminPassword</span><br><span class="line">手动安装 插件</span><br></pre></td></tr></table></figure>

<h4 id="Grafana-系统监控"><a href="#Grafana-系统监控" class="headerlink" title="Grafana   系统监控"></a>Grafana   系统监控</h4><p>访问入口:<a target="_blank" rel="noopener" href="http://101.201.249.217:7003/">http://101.201.249.217:7003</a></p>
<p>管理员密码:  admin  &#x2F;  nancal666</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 7003:3000 --name grafana grafana/grafana:latest</span><br></pre></td></tr></table></figure>

<h4 id="Docker-Compose-安装"><a href="#Docker-Compose-安装" class="headerlink" title="Docker Compose 安装"></a>Docker Compose 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Docker Compose 安装</span><br><span class="line">yum install epel-release</span><br><span class="line">pip3 install docker-compose</span><br><span class="line">yum install git</span><br></pre></td></tr></table></figure>

<h4 id="镜像管理-Harbor"><a href="#镜像管理-Harbor" class="headerlink" title="镜像管理   Harbor"></a>镜像管理   Harbor</h4><p>访问入口: <a target="_blank" rel="noopener" href="http://101.201.249.217:9880/">http://101.201.249.217:9880/</a></p>
<p>管理员账户:   admin	&#x2F;  Harbor12345</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.wget https://github.com/goharbor/harbor/releases/download/v1.10.4/harbor-online-installer-v1.10.4.tgz  -P 2./opt/docker -N</span><br><span class="line">3.tar zxvf /opt/docker/harbor-online-installer-v1.10.4.tgz -C /opt/docker</span><br><span class="line">4.wget <span class="variable">$host</span>/ops/harbor.yml -O /opt/docker/harbor/harbor.yml  (此步骤是编写yml文件)</span><br><span class="line">5.注意修改 : hosts为本机hosts, 注释https ,否则会找不到ssl证书报错  /   端口</span><br><span class="line">6./opt/docker/harbor/install.sh</span><br></pre></td></tr></table></figure>

<h4 id="elasticsearch"><a href="#elasticsearch" class="headerlink" title="elasticsearch"></a>elasticsearch</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">            --name elasticsearch \</span><br><span class="line">            --net mynet\</span><br><span class="line">            -p 9200:9200 \</span><br><span class="line">            -p 9300:9300  \</span><br><span class="line">            -e &quot;discovery.type=single-node&quot; \</span><br><span class="line">            -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx128m&quot; \</span><br><span class="line">            elasticsearch:7.3.1</span><br></pre></td></tr></table></figure>

<h4 id="es客户端工具"><a href="#es客户端工具" class="headerlink" title="es客户端工具"></a>es客户端工具</h4><p>访问入口: <a target="_blank" rel="noopener" href="http://101.201.249.217:9458/">http://101.201.249.217:9458/</a></p>
<p>链接es地址: <a target="_blank" rel="noopener" href="http://101.201.249.217:9200/">http://101.201.249.217:9200</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 9458:9800 -d --net mynet --link elasticsearch:demo containerize/elastichd</span><br></pre></td></tr></table></figure>

<h4 id="调用链监控-Skywalking"><a href="#调用链监控-Skywalking" class="headerlink" title="调用链监控  Skywalking"></a>调用链监控  Skywalking</h4><p>访问入口:  <a target="_blank" rel="noopener" href="http://101.201.249.217:9072/">http://101.201.249.217:9072/</a></p>
<p>安装服务端  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> docker run --name skywalking-oap \</span><br><span class="line">     --restart always -d \</span><br><span class="line">     -p 1234:1234 \</span><br><span class="line">     -p 11800:11800 \</span><br><span class="line">     -p 12800:12800 \</span><br><span class="line">     -e TZ=Asia/Shanghai \</span><br><span class="line">     -e SW_STORAGE=elasticsearch7 \</span><br><span class="line">     -e SW_STORAGE_ES_CLUSTER_NODES=101.201.249.217:9200 \</span><br><span class="line">     apache/skywalking-oap-server:8.1.0-es7</span><br><span class="line"></span><br><span class="line">-- 查询启动日志</span><br><span class="line"> docker logs --tail=100 -f skywalking-oap</span><br><span class="line">-- tips</span><br><span class="line"> 必须指定es7  不然会报错 启动日志显示Current image doesn&#x27;t Elasticsearch 6 </span><br></pre></td></tr></table></figure>

<p>安装UI端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name skywalking-ui \</span><br><span class="line">    --restart=always -d \</span><br><span class="line">    -e TZ=Asia/Shanghai \</span><br><span class="line">    -p 9072:8080  \</span><br><span class="line">    -e SW_OAP_ADDRESS=101.201.249.217:12800 \</span><br><span class="line">    apache/skywalking-ui:8.1.0-es7</span><br></pre></td></tr></table></figure>

<h4 id="代码分析-sonaqube"><a href="#代码分析-sonaqube" class="headerlink" title="代码分析  sonaqube"></a>代码分析  sonaqube</h4><p>访问入口: <a target="_blank" rel="noopener" href="http://101.201.249.217:9900/">http://101.201.249.217:9900/</a></p>
<p>管理员密码:  admin &#x2F;admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 创建 sonarqube 工作目录，映射目录都放在这里</span><br><span class="line">mkdir -p /usr/local/sonarqube &amp;&amp; cd /usr/local/sonarqube</span><br><span class="line"></span><br><span class="line"># 创建映射目录，查看日志</span><br><span class="line">mkdir /usr/local/sonarqube/data &amp;&amp; \</span><br><span class="line">mkdir /usr/local/sonarqube/extensions &amp;&amp; \</span><br><span class="line">mkdir /usr/local/sonarqube/logs</span><br><span class="line"></span><br><span class="line"># 设置为 777 权限，否则映射不生效</span><br><span class="line"># 可能是因为我用 root 用户操作，而容器内部用的 sonarqube 用户</span><br><span class="line">chmod 777 /usr/local/sonarqube/data &amp;&amp; \</span><br><span class="line">chmod 777 /usr/local/sonarqube/extensions &amp;&amp; \</span><br><span class="line">chmod 777 /usr/local/sonarqube/logs</span><br><span class="line"></span><br><span class="line">#启动</span><br><span class="line">docker run -d --name sonarqube \</span><br><span class="line">    -p 9900:9000 \</span><br><span class="line">    -v /usr/local/sonarqube/data:/opt/sonarqube/data \</span><br><span class="line">    -v /usr/local/sonarqube/extensions:/opt/sonarqube/extensions \</span><br><span class="line">    -v /usr/local/sonarqube/logs:/opt/sonarqube/logs \</span><br><span class="line">    sonarqube:8.3-community</span><br></pre></td></tr></table></figure>

<h4 id="Ceph管理-Ceph-分布式文件管理系统"><a href="#Ceph管理-Ceph-分布式文件管理系统" class="headerlink" title="Ceph管理   Ceph  分布式文件管理系统"></a>Ceph管理   Ceph  分布式文件管理系统</h4><h4 id="K8s管理-KUboard-安装完k8s-之后才会使用"><a href="#K8s管理-KUboard-安装完k8s-之后才会使用" class="headerlink" title="K8s管理   KUboard    (安装完k8s 之后才会使用)"></a>K8s管理   KUboard    (安装完k8s 之后才会使用)</h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tree</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">185k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">5:09</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
